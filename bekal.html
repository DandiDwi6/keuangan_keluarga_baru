<!DOCTYPE html> 
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bekal Saya</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Poppins}
body{background:#eef2f7}

/* TOPBAR */
.topbar{
position:fixed;top:0;left:0;width:100%;height:70px;
background:linear-gradient(135deg,#2563eb,#3b82f6);
color:white;display:flex;align-items:center;padding:0 25px;
z-index:1000;box-shadow:0 10px 30px rgba(0,0,0,.25);
}
.menu-btn{font-size:22px;cursor:pointer;margin-right:15px}

/* SIDEBAR */
.sidebar{
position:fixed;top:70px;left:-260px;width:260px;height:calc(100% - 70px);
background:linear-gradient(135deg,#2563eb,#3b82f6);
padding-top:20px;transition:.3s;z-index:1000;
}
.sidebar.show{left:0}
.sidebar a{display:flex;gap:12px;padding:18px 25px;color:#cbd5e1;text-decoration:none}
.sidebar a:hover{background:rgba(255,255,255,.1);color:white}

/* OVERLAY */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.4);
opacity:0;pointer-events:none;transition:.3s;z-index:998;}
.overlay.show{opacity:1;pointer-events:auto}

/* MAIN */
.main{padding:100px 30px 30px}

/* CARD */
.card{
background:white;padding:25px;border-radius:18px;
box-shadow:0 15px 35px rgba(0,0,0,.08);
margin-bottom:20px;overflow:hidden;
}

/* RUNNING TEXT */
.runningBox{
background:#f8fafc;
padding:12px;
border-radius:12px;
margin-bottom:15px;
overflow:hidden;
}
#runningText{
white-space:nowrap;
display:inline-block;
padding-left:100%;
animation:runText 12s linear infinite;
font-weight:600;
}
@keyframes runText{
from{transform:translateX(0)}
to{transform:translateX(-120%)}
}

.alertMerah{
color:#dc2626;
font-weight:700;
margin-top:8px;
display:none;
}

/* INPUT */
input{
width:100%;padding:12px;margin-bottom:12px;
border-radius:10px;border:1px solid #e2e8f0;
}

/* BUTTON */
button{
width:100%;padding:14px;border:none;border-radius:12px;
background:#2563eb;color:white;font-weight:600;cursor:pointer;
}

/* RIWAYAT MOBILE FIX */
.riwayat-wrap{overflow-x:auto}
table{width:100%;min-width:450px;border-collapse:collapse}
th,td{padding:10px;border-bottom:2px solid #e2e8f0}
th{background:#f8fafc;text-align:left;position:sticky;top:0}
.hidden{display:none}
.loading{color:#94a3b8;font-style:italic}
</style>
</head>

<body>

<div class="sidebar" id="sidebar">
<a href="dashboard.html">üè† Dashboard</a>
<a href="transaksi.html">üí∏ Transaksi</a>
<a href="bekal.html">üíº Bekal</a>
</div>

<div class="overlay" id="overlay" onclick="toggleMenu()"></div>

<div class="topbar">
<div class="menu-btn" onclick="toggleMenu()">‚ò∞</div>
<div>üíº Bekal Suami</div>
</div>

<div class="main">

<!-- SALDO -->
<div class="card">

<div id="runningSuami" class="runningBox hidden">
<div id="runningText">Loading...</div>
</div>

<h3>Saldo Bekal</h3>
<p>Saldo: <b id="saldo" class="loading">Loading...</b></p>
<p>Total Masuk: <b id="masuk" class="loading">Loading...</b></p>
<p>Total Keluar: <b id="keluar" class="loading">Loading...</b></p>

<div id="alertTipis" class="alertMerah">
‚ö†Ô∏è Bekal harian sudah di bawah 50rb!
</div>

</div>

<!-- FORM ISTRI -->
<div class="card hidden" id="formIstri">
<h3>Transfer Bekal ke Suami</h3>
<input id="bekalMasuk" placeholder="Nominal Bekal">
<input id="ketMasuk" placeholder="Keterangan">
<button id="btnBekal" onclick="tambahBekal()">Transfer Bekal</button>
</div>

<!-- FORM SUAMI -->
<div class="card hidden" id="formSuami">
<h3>Tambah Pengeluaran Bekal</h3>
<input id="nominal" placeholder="Nominal">
<input id="ket" placeholder="Keterangan">
<button id="btnKeluar" onclick="simpan()">Simpan Pengeluaran</button>
</div>

<!-- RIWAYAT -->
<div class="card">
<h3>Riwayat Bekal</h3>
<div class="riwayat-wrap">
<table id="tbl">
<tr><th>Tanggal</th><th>Jenis</th><th>Nominal</th><th>Keterangan</th></tr>
</table>
</div>
</div>

</div>

<script>
const url="https://script.google.com/macros/s/AKfycbykSlA2XD2AsovwsQBfqvbmMnSLUchFsyjxr6QdCoKstySkaEC7E9iw-Rab_u3ih8T7/exec";

/* MENU */
function toggleMenu(){
sidebar.classList.toggle("show");
overlay.classList.toggle("show");
}

const role=localStorage.getItem("role");
if(role==="admin") formIstri.classList.remove("hidden");
else{
formSuami.classList.remove("hidden");
runningSuami.classList.remove("hidden");
}

/* LOAD DATA */
load();

function load(){
fetch(`${url}?action=getSaldoBekal`)
.then(r=>r.json())
.then(d=>{
saldo.classList.remove("loading");
masuk.classList.remove("loading");
keluar.classList.remove("loading");

saldo.innerText="Rp "+d.saldo.toLocaleString();
masuk.innerText="Rp "+d.totalBekal.toLocaleString();
keluar.innerText="Rp "+d.totalKeluar.toLocaleString();

if(role!=="admin"){
updateRunning(d.saldo);
}
});
}

/* ===== LOGIKA RUNNING ===== */
function updateRunning(saldo){

const today = new Date();
const hari = today.getDay(); // 0 = minggu
const sisaHari = 7 - hari;

const perHari = Math.floor(saldo / sisaHari);

runningText.innerText =
`Sisa ${sisaHari} hari minggu ini ‚Ä¢ Bekal tersisa Rp ${saldo.toLocaleString()} ‚Ä¢ Aman dipakai Rp ${perHari.toLocaleString()} / hari`;

if(perHari < 50000){
alertTipis.style.display="block";
}else{
alertTipis.style.display="none";
}
}

/* SUAMI INPUT */
function simpan(){
fetch(url,{
method:"POST",
body:JSON.stringify({
action:"addPengeluaranBekal",
nominal:nominal.value,
keterangan:ket.value
})
}).then(()=>location.reload());
}

/* ISTRI TRANSFER */
function tambahBekal(){
fetch(url,{
method:"POST",
body:JSON.stringify({
action:"addBekal",
nominal:bekalMasuk.value,
keterangan:ketMasuk.value
})
}).then(()=>location.reload());
}
</script>

</body>
</html>
